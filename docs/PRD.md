# 결제 서비스 개발을 위한 PRD (Product Requirements Document)

## 1. 프로젝트 개요

### 1.1. 목적

본 프로젝트는 Java 8과 **Spring Framework(boot 아님)**를 기반으로 결제 진행, 가상계좌, 결제 취소 기능을 갖춘 간단하고 효율적인 결제 서비스를 개발하는 것입니다. 프론트엔드는 별도로 개발하지 않고 포트원(PortOne) SDK를 활용하여 필수적인 버튼만 작성하여 결제 기능을 구현합니다. MVC 패턴에 집중하여 핵심 기능의 완성도를 높입니다.

### 1.2. 목표

단순하고 간결한 API를 제공하여 개발 및 유지보수를 용이하게 합니다.
MVC 패턴을 준수하여 코드의 가독성과 확장성을 높입니다.
포트원 SDK를 활용하여 결제 기능을 신속하고 안정적으로 구현합니다.
핵심 기능에 집중하여 사용자에게 원활한 결제 경험을 제공합니다.

## 2. 유저 플로우

**상품 선택**: 사용자가 상품 또는 서비스를 선택합니다.
**결제 요청**: 사용자가 결제 버튼을 클릭합니다.
**결제 진행**: 포트원 SDK를 통해 결제창이 호출되고, 사용자는 결제 정보를 입력합니다.
**결제 결과 확인**: 결제 완료 후 서버에서 결제 정보를 검증하고, 결과를 사용자에게 제공합니다.
**가상계좌 발급(필요 시)**: 가상계좌 결제의 경우 계좌 정보를 사용자에게 제공합니다.
**결제 취소(필요 시)**: 사용자가 결제를 취소하고자 할 경우 결제 취소 절차를 진행합니다.

## 3. 핵심 기능

### 3.1. 결제 진행

**포트원 SDK 초기화**: 고객사 식별코드를 사용하여 SDK를 초기화합니다.

```javascript
IMP.init("고객사 식별코드"); // 예: 'imp00000000'
```

**결제창 호출**: 결제 요청 파라미터를 설정하여 결제창을 호출합니다. 키값과 구조는 수정하지 않고, 값은 필요에 따라 변경합니다.

```javascript
IMP.request_pay(
  {
    channelKey: "{콘솔 내 연동 정보의 채널키}",
    pay_method: "card",
    merchant_uid: `payment-${crypto.randomUUID()}`, // 주문 고유 번호
    name: "노르웨이 회전 의자",
    amount: 64900,
    buyer_email: "gildong@gmail.com",
    buyer_name: "홍길동",
    buyer_tel: "010-4242-4242",
    buyer_addr: "서울특별시 강남구 신사동",
    buyer_postcode: "01181",
  },
  function (response) {
    // 결제 종료 시 호출되는 콜백 함수
    // response.imp_uid 값으로 결제 단건조회 API를 호출하여 결제 결과를 확인하고,
    // 결제 결과를 처리하는 로직을 작성합니다.
  },
);
```

**결제 결과 처리**: 결제 완료 후 콜백 함수를 통해 결과를 확인하고 서버에 전달합니다. 키값과 구조는 수정하지 않고, 값은 필요에 따라 변경합니다.

```javascript
async (response) => {
  if (response.error_code != null) {
    return alert(`결제에 실패하였습니다. 에러 내용: ${response.error_msg}`);
  }

  const notified = await fetch(`${SERVER_BASE_URL}/payment/complete`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    // imp_uid와 merchant_uid, 주문 정보를 서버에 전달합니다
    body: JSON.stringify({
      imp_uid: response.imp_uid,
      merchant_uid: response.merchant_uid,
      // 주문 정보...
    }),
  });
}
```

### 3.2. 가상계좌 처리

가상계좌 발급 시 payment.status가 ready인 경우 계좌 정보를 사용자에게 제공합니다.
입금 확인 후 결제 완료 처리를 진행합니다.

### 3.3. 결제 취소

결제 건에 대한 취소 요청을 받아 포트원 API를 통해 취소 처리를 합니다.
취소 결과를 사용자에게 전달하고, 필요한 경우 환불 절차를 진행합니다.

## 4. 기술 스택

### 백엔드

- Java 8
- Spring Framework (Boot 아님)
- RESTful API 설계

### 프론트엔드:
- 포트원(PortOne) JavaScript SDK 활용
- 필수적인 버튼만 작성 (별도의 프론트엔드 개발 없이)
- CSS (스타일링 최소화)

### 라이브러리 및 SDK:
- 포트원(PortOne) JavaScript SDK
필요한 경우 추가적인 라이브러리 활용

### 기타:
MVC 패턴 준수
- 기능 구현에 필요한 라이브러리 최대한 활용

## 5. MVC 패턴 기능 개발 이후 추가 개선 사항

### 보안 강화:
  - HTTPS 프로토콜 적용
  - 입력 데이터 검증 및 위변조 방지 로직 추가

### 테스트 및 검증:

- 단위 테스트 및 통합 테스트 작성
- 결제 프로세스 시나리오 테스트
### 로그 및 모니터링:
- 결제 오류 로그 수집 및 분석
- 실시간 모니터링 시스템 연동

### UI/UX 개선:
- 사용자 친화적인 결제 진행 안내
- 결제 상태에 따른 메시지 제공

### 다국어 지원:
- 다국어 결제 페이지 제공
- 지역화된 결제 수단 지원

### 확장 기능:
- 다양한 결제 수단 추가 (예: 간편결제, 모바일 결제)
회원 관리 및 결제 내역 조회 기능

### 성능 최적화:
- API 응답 속도 개선
- 캐싱 전략 도입
